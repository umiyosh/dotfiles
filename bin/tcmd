#!/usr/bin/env bash

cmd=$1
shift
hosts=("$@")

is_first="true"
for host in ${hosts[@]}; do
  chunk="$cmd $host"
  if [ "${is_first}" == "true" ]; then
    tmux send-keys "$chunk" C-m
    is_first="false"
  else
    tmux split-window "$chunk"
    tmux select-layout tiled 1>/dev/null
  fi
done

tmux set-window-option synchronize-panes on
tmux select-pane -t 0
exit
