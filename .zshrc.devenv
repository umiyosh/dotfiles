# python
export PATH=~/.local/bin:$PATH
source ~/python_v3.13/bin/activate
# source "$HOME/.rye/env"
eval "$(direnv hook zsh)"

# export PYENV_ROOT="$HOME/.pyenv"
# export PATH="$PYENV_ROOT/bin:$PATH"
# eval "$(pyenv init --path)"

# perlbrew
if [[ -s $HOME/perl5/perlbrew/etc/bashrc ]]; then
  source $HOME/perl5/perlbrew/etc/bashrc
fi

# node関連
export PATH=$PATH:${HOME}/.nodebrew/current/bin
source ${HOME}/dotfiles/.zshrc.complition.npm

# golang

# GVM環境変数の設定（cdフックなし版）
if [[ -f $HOME/.gvm/scripts/env/gvm ]] ; then
  export GVM_ROOT=/Users/yoshikazu.umino/.gvm
  unset GOROOT
  unset GOARCH
  unset GOOS
  unset GOPATH
  unset GOBIN

  unset gvm_go_name
  unset gvm_pkgset_name

  if [[ ! -d "$GVM_ROOT/logs" ]]; then
    mkdir -p "$GVM_ROOT/logs" > /dev/null 2>&1
    mkdir -p "$GVM_ROOT/gos" > /dev/null 2>&1
    mkdir -p "$GVM_ROOT/archive" > /dev/null 2>&1
    mkdir -p "$GVM_ROOT/archive/package" > /dev/null 2>&1
    mkdir -p "$GVM_ROOT/environments" > /dev/null 2>&1
  fi

  export GVM_VERSION=$(cat "$GVM_ROOT/VERSION")
  export PATH="$GVM_ROOT/bin:$PATH"
  export GVM_PATH_BACKUP="$PATH"
  [ -f "$GVM_ROOT/environments/default" ] && . "$GVM_ROOT/environments/default"

  # --- gvm lazy shim: env/gvm のみを読み、scripts/gvm は読まない ---
  gvm() {
    # 初回実行時だけ本体を読み込んで差し替え
    unset -f gvm 2>/dev/null
    # shellcheck source=/dev/null
    . "$HOME/.gvm/scripts/env/gvm"
    # gvmのcdフックを即座に無効化
    unset -f cd 2>/dev/null
    gvm "$@"  # 以後は本物のgvm関数が呼ばれる
  }
fi

# cdは常にビルトインを使用（gvmのcd関数オーバーライドを完全無効化）
unset -f cd 2>/dev/null
# alias cd='builtin cd'

# composer
# export PATH=$PATH:${HOME}/.composer/vendor/bin

# rbenv
if type rbenv &> /dev/null; then
  RBENV_SHIMS="${RBENV_ROOT:-${HOME}/.rbenv}/shims"
  export PATH="${RBENV_SHIMS}:${PATH}"
  function rbenv() {
    unset -f rbenv > /dev/null 2>&1
    eval "$(command rbenv init -)"
    rbenv "$@"
  }
fi

# scalaenv
# export PATH="${HOME}/.scalaenv/bin:${PATH}"
# eval "$(scalaenv init -)"

# rustup
# source $HOME/.cargo/env

# The next line updates PATH for the Google Cloud SDK.
source "${HOME}/google-cloud-sdk/path.zsh.inc"
source "${HOME}/google-cloud-sdk/completion.zsh.inc"

# kubernetes
export PATH="${PATH}:${HOME}/.krew/bin"
export PATH="${KREW_ROOT:-$HOME/.krew}/bin:$PATH"

# java
# Java
export JAVA_HOME=/opt/homebrew/opt/openjdk@11
export PATH=$JAVA_HOME/bin:$PATH

# Claude Code環境でgvmのcdフックを確実に無効化
# （最後に再度実行して確実に無効化）
if [[ -n "$CLAUDE_CODE_ENV" ]] || [[ $(which cd 2>/dev/null | head -n1) =~ "gvm" ]]; then
  unset -f cd 2>/dev/null
fi
